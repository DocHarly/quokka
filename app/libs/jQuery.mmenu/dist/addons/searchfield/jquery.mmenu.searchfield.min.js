/*	
 * jQuery mmenu searchfield add-on
 * mmenu.frebsite.nl
 *
 * Copyright (c) Fred Heusschen
 */
!function(e){function s(e){switch(e){case 9:case 16:case 17:case 18:case 37:case 38:case 39:case 40:return!0}return!1}var n="mmenu",a="searchfield";e[n].addons[a]={setup:function(){var r=this,o=this.opts[a],c=this.conf[a];d=e[n].glbl,"boolean"==typeof o&&(o={add:o}),"object"!=typeof o&&(o={}),"boolean"==typeof o.resultsPanel&&(o.resultsPanel={add:o.resultsPanel}),o=this.opts[a]=e.extend(!0,{},e[n].defaults[a],o),c=this.conf[a]=e.extend(!0,{},e[n].configuration[a],c),this.bind("close:start",function(){this.$menu.find("."+l.search).find("input").blur()}),this.bind("initPanels:after",function(d){if(o.add){var h;switch(o.addTo){case"panels":h=d;break;default:h=this.$menu.find(o.addTo)}if(h.each(function(){var s=e(this);if(!s.is("."+l.panel)||!s.is("."+l.vertical)){if(!s.children("."+l.search).length){var a=r.__valueOrFn(c.clear,s),t=r.__valueOrFn(c.form,s),d=r.__valueOrFn(c.input,s),h=r.__valueOrFn(c.submit,s),u=e("<"+(t?"form":"div")+' class="'+l.search+'" />'),f=e('<input placeholder="'+e[n].i18n(o.placeholder)+'" type="text" autocomplete="off" />');u.append(f);var p;if(d)for(p in d)f.attr(p,d[p]);if(a&&e('<a class="'+l.btn+" "+l.clear+'" href="#" />').appendTo(u).on(i.click+"-searchfield",function(e){e.preventDefault(),f.val("").trigger(i.keyup+"-searchfield")}),t){for(p in t)u.attr(p,t[p]);h&&!a&&e('<a class="'+l.btn+" "+l.next+'" href="#" />').appendTo(u).on(i.click+"-searchfield",function(e){e.preventDefault(),u.submit()})}s.hasClass(l.search)?s.replaceWith(u):s.prepend(u).addClass(l.hassearch)}if(o.noResults){var v=s.closest("."+l.panel).length;if(v||(s=r.$pnls.children("."+l.panel).first()),!s.children("."+l.noresultsmsg).length){var m=s.children("."+l.listview).first();e('<div class="'+l.noresultsmsg+" "+l.hidden+'" />').append(e[n].i18n(o.noResults))[m.length?"insertAfter":"prependTo"](m.length?m:s)}}}}),o.search){if(o.resultsPanel.add){o.showSubPanels=!1;var u=this.$pnls.children("."+l.resultspanel);u.length||(u=e('<div class="'+l.panel+" "+l.resultspanel+" "+l.noanimation+" "+l.hidden+'" />').appendTo(this.$pnls).append('<div class="'+l.navbar+" "+l.hidden+'"><a class="'+l.title+'">'+e[n].i18n(o.resultsPanel.title)+"</a></div>").append('<ul class="'+l.listview+'" />').append(this.$pnls.find("."+l.noresultsmsg).first().clone()),this.initPanels(u))}this.$menu.find("."+l.search).each(function(){var n,d,c=e(this),h=c.closest("."+l.panel).length;h?(n=c.closest("."+l.panel),d=n):(n=e("."+l.panel,r.$menu),d=r.$menu),o.resultsPanel.add&&(n=n.not(u));var f=c.children("input"),p=r.__findAddBack(n,"."+l.listview).children("li"),v=p.filter("."+l.divider),m=r.__filterListItems(p),b="a",g=b+", span",C="",_=function(){var s=f.val().toLowerCase();if(s!=C){if(C=s,o.resultsPanel.add&&u.children("."+l.listview).empty(),n.scrollTop(0),m.add(v).addClass(l.hidden).find("."+l.fullsubopensearch).removeClass(l.fullsubopen+" "+l.fullsubopensearch),m.each(function(){var s=e(this),n=b;(o.showTextItems||o.showSubPanels&&s.find("."+l.next))&&(n=g);var a=s.data(t.searchtext)||s.children(n).text();a.toLowerCase().indexOf(C)>-1&&s.add(s.prevAll("."+l.divider).first()).removeClass(l.hidden)}),o.showSubPanels&&n.each(function(s){var n=e(this);r.__filterListItems(n.find("."+l.listview).children()).each(function(){var s=e(this),n=s.data(t.child);s.removeClass(l.nosubresults),n&&n.find("."+l.listview).children().removeClass(l.hidden)})}),o.resultsPanel.add)if(""===C)this.closeAllPanels(),this.openPanel(this.$pnls.children("."+l.subopened).last());else{var a=e();n.each(function(){var s=r.__filterListItems(e(this).find("."+l.listview).children()).not("."+l.hidden).clone(!0);s.length&&(o.resultsPanel.dividers&&(a=a.add('<li class="'+l.divider+'">'+e(this).children("."+l.navbar).children("."+l.title).text()+"</li>")),a=a.add(s))}),a.find("."+l.next).remove(),u.children("."+l.listview).append(a),this.openPanel(u)}else e(n.get().reverse()).each(function(s){var n=e(this),a=n.data(t.parent);a&&(r.__filterListItems(n.find("."+l.listview).children()).length?(a.hasClass(l.hidden)&&a.children("."+l.next).not("."+l.fullsubopen).addClass(l.fullsubopen).addClass(l.fullsubopensearch),a.removeClass(l.hidden).removeClass(l.nosubresults).prevAll("."+l.divider).first().removeClass(l.hidden)):h||(n.hasClass(l.opened)&&setTimeout(function(){r.openPanel(a.closest("."+l.panel))},(s+1)*(1.5*r.conf.openingInterval)),a.addClass(l.nosubresults)))});d.find("."+l.noresultsmsg)[m.not("."+l.hidden).length?"addClass":"removeClass"](l.hidden),this.trigger("updateListview")}};f.off(i.keyup+"-"+a+" "+i.change+"-"+a).on(i.keyup+"-"+a,function(e){s(e.keyCode)||_.call(r)}).on(i.change+"-"+a,function(e){_.call(r)});var w=c.children("."+l.btn);w.length&&f.on(i.keyup+"-"+a,function(e){w[f.val().length?"removeClass":"addClass"](l.hidden)}),f.trigger(i.keyup+"-"+a)})}}})},add:function(){l=e[n]._c,t=e[n]._d,i=e[n]._e,l.add("clear search hassearch resultspanel noresultsmsg noresults nosubresults fullsubopensearch"),t.add("searchtext"),i.add("change keyup")},clickAnchor:function(e,s){}},e[n].defaults[a]={add:!1,addTo:"panels",placeholder:"Search",noResults:"No results found.",resultsPanel:{add:!1,dividers:!0,title:"Search results"},search:!0,showTextItems:!1,showSubPanels:!0},e[n].configuration[a]={clear:!1,form:!1,input:!1,submit:!1};var l,t,i,d}(jQuery);